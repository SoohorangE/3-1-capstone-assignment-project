# 인공지능 개발 프로젝트 최종보고서

**프로젝트명:** YOLOv8을 활용한 동영상 화재 분석 시스템

**과목명:** 캡스톤 프로젝트3

**학번 / 이름:** 2023143017 / 정수호

**제출일:** 2025.10.21

---

## 1. 프로젝트 개요

### 1.1 프로젝트명

**YOLOv8 기반 동영상 화재 분석 시스템 (Video Fire Analysis System based on YOLOv8)**

### 1.2 프로젝트 목표

사용자가 업로드한 동영상 파일에서 화재 발생 여부를 신속하고 정확하게 탐지하는 인공지능 모델을 구축하고, 이를 웹 서비스로 제공하여 화재 발생 상황을 분석하고 시각적으로 확인할 수 있는 시스템을 개발한다.

### 1.3 개발 동기 및 필요성

화재는 막대한 인명 및 재산 피해를 유발할 수 있는 심각한 재난입니다. 기존의 연기 및 온도 감지기는 화재가 어느 정도 진행된 후에야 작동하는 한계가 있습니다. CCTV 영상 기록을 AI로 분석하면 화재 발생 초기의 시각적 징후(불꽃, 연기)를 포착하여 사고 원인 분석, 피해 규모 예측, 그리고 향후 예방 대책 수립에 중요한 정보를 제공할 수 있습니다. 본 프로젝트는 이러한 필요성에 따라 YOLOv8 모델을 활용하여 빠르고 효율적인 동영상 화재 분석 시스템을 구현하고자 합니다.

---

## 2. 가상환경 및 의존성 설정

Python 3.9+ 버전이 설치된 환경에서 아래 명령어를 실행하여 가상환경을 생성하고 필요한 라이브러리를 설치합니다.

```bash
# 프로젝트 디렉토리로 이동
cd 3-1-capstone-assignment-project

# 가상환경 생성
python -m venv .venv

# 가상환경 활성화 (Windows)
.\.venv\Scripts\Activate.ps1

# 의존성 설치
pip install -r requirements.txt
```

---

## 3. 개발 환경 및 도구

| 항목 | 내용 |
| --- | --- |
| **언어** | Python 3.9+ |
| **AI 프레임워크** | PyTorch, Ultralytics YOLOv8 |
| **백엔드 서버** | FastAPI |
| **비디오/이미지 처리** | OpenCV, NumPy |
| **웹 서버** | Uvicorn |
| **개발 환경** | PyCharm, Visual Studio Code |
| **버전 관리** | Git, GitHub |

---

## 4. 시스템 구조

```
사용자 동영상 파일 업로드 (웹 UI)
      ↓
FastAPI 서버 수신
      ↓
비디오 프레임 단위 분할 (OpenCV)
      ↓
YOLOv8 모델 화재 감지 및 추적
      ↓
결과 프레임에 바운딩 박스 시각화
      ↓
처리된 영상 파일 생성
      ↓
사용자에게 결과 영상 제공 (다운로드)
```

---

## 5. 모델 학습 및 성능

| 항목 | 내용 |
| --- | --- |
| **사전 학습 모델** | YOLOv8s (small) |
| **입력 이미지 크기** | **1024x1024** |
| **데이터셋** | 커스텀 화재/연기 이미지 데이터셋 |
| **손실 함수 / 옵티마이저** | Ultralytics 기본값 (CIoU, DFL / AdamW) |
| **정확도(mAP@50)** | **73.8%** |
| **평균 추론 시간** | 1 프레임 당 평균 30 ~ 35ms (RTX 3080 기준) |

### 혼동 행렬 (Confusion Matrix)

`train4` 학습 실행 결과로 생성된 혼동 행렬입니다. 모델이 'fire'와 'smoke' 클래스를 얼마나 잘 분류했는지 보여줍니다.

![Confusion Matrix](runs/detect/train4/confusion_matrix.png)

---

## 6. 모델 학습 방법 (How to Train)

**참고:** 이 프로젝트에는 이미 학습된 모델 가중치(`app/models/best.pt`)가 포함되어 있어, 별도의 학습 과정 없이 바로 시스템을 실행할 수 있습니다. 모델을 직접 학습시키고 싶은 경우에만 아래 과정을 진행해 주세요.

1.  **데이터셋 준비:** 참고 자료의 데이터셋 링크에서 데이터를 다운로드합니다.
2.  **데이터셋 위치:** 다운로드한 데이터셋의 압축을 해제한 후, 프로젝트 내 `model-train/data` 폴더에 파일을 위치시킵니다.
3.  **모델 학습 실행:** `model-train/train.py` 파일을 실행하여 모델 학습을 시작합니다.
4.  **학습된 가중치 적용:** 학습이 완료되면 일반적으로 `runs/detect/train/weights/best.pt` 경로에 최적의 가중치 파일이 생성됩니다. 이 `best.pt` 파일을 `app/models/` 디렉토리로 복사하거나 이동시키면, 시스템이 새로운 모델을 기반으로 동작하게 됩니다.

---

## 7. 문제점 및 해결 과정

### 7.1 비화재 객체 오탐지 (False Positive)

- **문제:** 붉은색 옷, 주황색 조명, 노을 등 화재와 유사한 색상의 객체를 화재로 잘못 인식하는 경우가 발생했습니다.
- **해결:** 다양한 환경(낮, 밤, 실내, 실외)에서 촬영된 비화재 이미지를 'Negative' 샘플로 추가하여 학습시켰습니다. 이를 통해 모델이 화재의 형태와 질감, 동적인 특성을 더 잘 학습하도록 유도하여 오탐지율을 **약 15% 감소**시켰습니다.

### 7.2 작은 크기의 화재 탐지 성능 저하

- **문제:** 영상에서 멀리 떨어져 있거나 초기에 발생한 작은 크기의 불꽃을 탐지하지 못하는 경우가 많았습니다.
- **해결:** **학습 해상도를 640x640에서 1024x1024로 상향**하고, 데이터 증강(Augmentation) 시 이미지의 일부를 확대(zoom-in)하는 기법을 적용했습니다. 이를 통해 모델이 작은 객체에 더 민감하게 반응하도록 개선하여 작은 객체에 대한 탐지율(Recall)이 **약 10% 이상 향상**되었습니다.

### 7.3 대용량 동영상 처리 시 병목 현상

- **문제:** 고해상도 또는 긴 길이의 동영상 처리 시 FastAPI 서버에서 병목 현상이 발생하여 전체 처리 시간이 길어졌습니다.
- **해결:** `asyncio.to_thread`를 사용하여 동기적인 영상 처리 함수(`process_video_sync`)를 별도의 스레드에서 실행하도록 변경했습니다. 이를 통해 FastAPI의 이벤트 루프가 블로킹되는 것을 방지하여 여러 요청을 동시에 처리할 수 있도록 개선하고 응답성을 높였습니다.

---

## 8. 개발 중 느낀 점

- AI 모델의 성능은 알고리즘뿐만 아니라 데이터의 질과 양에 크게 좌우된다는 것을 체감했습니다. 특히 오탐지를 줄이기 위한 'Negative' 데이터의 중요성을 깨달았습니다.
- 단순히 모델을 학습시키는 것을 넘어, FastAPI를 이용해 실제 사용자가 쓸 수 있는 서비스로 만드는 과정에서 백엔드 시스템과 비동기 처리에 대한 이해를 높일 수 있었습니다.
- AI 시스템은 모델의 정확도와 함께 추론 속도, 시스템 안정성 등 여러 요소를 함께 고려해야 하는 종합적인 공학 분야임을 배웠습니다.

---

## 9. 향후 개선 방향

1.  **실시간 스트리밍 분석 기능 추가**: 현재는 동영상 파일 분석에 중점을 두지만, 향후 CCTV 등 실시간 스트리밍 영상을 직접 받아 분석하는 기능으로 확장.
2.  **화재 발생 시점 및 지속 시간 분석**: 동영상 내에서 화재가 처음 감지된 시점과 지속 시간을 정량적으로 분석하여 리포트 제공.
3.  **모델 경량화**: ONNX 또는 TensorRT로 모델을 변환하여 더 빠른 처리 속도를 확보하고, 다양한 환경에서의 배포 가능성 모색.

---

## 10. 참고 자료 (References)

- **YOLO (You Only Look Once):** [https://github.com/ultralytics/ultralytics](https://github.com/ultralytics/ultralytics)
- **Dataset:** [https://www.kaggle.com/datasets/sayedgamal99/smoke-fire-detection-yolo](https://www.kaggle.com/datasets/sayedgamal99/smoke-fire-detection-yolo)

---
